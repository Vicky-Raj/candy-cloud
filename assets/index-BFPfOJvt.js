import{ad as V,K as h,j as e,ao as A,ap as k,B as S,C as H,G as w,q as P,P as $,ak as B,T as y,A as N,al as z,am as b,a2 as F,an as G,o as W}from"./index-BqrwD2Al.js";import{c as E,u as Y,g as q,e as K,h as U,i as J,I as L,T as u,f as O,a as Q,b as X,d as Z,P as _}from"./index-DOOpfH9O.js";const ee=[{collectionId:"COL001",orderId:"ORD001",collectionDate:"15/01/2023",amountCollected:15.99*2,paymentMethod:"Card",status:"Collected"},{collectionId:"COL002",orderId:"ORD002",collectionDate:"20/02/2023",amountCollected:22.5,paymentMethod:"Online",status:"Collected"},{collectionId:"COL003",orderId:"ORD003",collectionDate:"10/03/2023",amountCollected:12*5,paymentMethod:"Cash",status:"Pending"},{collectionId:"COL004",orderId:"ORD004",collectionDate:"12/03/2023",amountCollected:10.75*3,paymentMethod:"Card",status:"Collected"},{collectionId:"COL005",orderId:"ORD005",collectionDate:"01/04/2023",amountCollected:0,paymentMethod:"Online",status:"Failed"},{collectionId:"COL006",orderId:"ORD003",collectionDate:"15/03/2023",amountCollected:20,paymentMethod:"Transfer",status:"Processing"}];function T(o){if(!o)return null;const a=o.split("/");if(a.length===3){const g=parseInt(a[0],10),m=parseInt(a[1],10)-1,p=parseInt(a[2],10);if(!isNaN(g)&&!isNaN(m)&&!isNaN(p)){const c=new Date(p,m,g);if(c.getFullYear()===p&&c.getMonth()===m&&c.getDate()===g)return c}}return null}const C=E();function te({column:o}){var m,p,c,D;const a=o.getFilterValue(),g=(m=o.columnDef.meta)==null?void 0:m.filterVariant;if(g==="number-range"){const[s,x]=h.useState(!1),v=a==null?void 0:a[0],I=a==null?void 0:a[1],[f,j]=h.useState(v),[l,t]=h.useState(I),n=(p=o.columnDef.meta)==null?void 0:p.rangeMin,r=(c=o.columnDef.meta)==null?void 0:c.rangeMax,d=((D=o.columnDef.meta)==null?void 0:D.rangeStep)??.01;return h.useMemo(()=>{s||(j(a==null?void 0:a[0]),t(a==null?void 0:a[1]))},[a,s]),e.jsxs(b,{opened:s,onClose:()=>x(!1),position:"bottom-start",withArrow:!0,shadow:"md",trapFocus:!0,onOpen:()=>{j(a==null?void 0:a[0]),t(a==null?void 0:a[1])},children:[e.jsx(b.Target,{children:e.jsx(N,{variant:s?"filled":o.getIsFiltered()?"light":"default",onClick:()=>x(i=>!i),size:"input-xs",title:`Filter ${o.columnDef.header}`,style:{lineHeight:1},children:e.jsx(L,{size:"1rem"})})}),e.jsx(b.Dropdown,{p:"sm",style:{minWidth:230},children:e.jsxs(S,{children:[e.jsxs(w,{grow:!0,align:"flex-start",gap:"xs",children:[e.jsx(F,{label:"Min Amount",placeholder:n!==void 0?`Min: ${n}`:"Minimum",value:f===void 0?"":f,onChange:i=>j(i===""?void 0:Number(i)),min:n,max:l??r,step:d,size:"xs",variant:"filled",style:{flex:1}}),e.jsx(F,{label:"Max Amount",placeholder:r!==void 0?`Max: ${r}`:"Maximum",value:l===void 0?"":l,onChange:i=>t(i===""?void 0:Number(i)),min:f??n,max:r,step:d,size:"xs",variant:"filled",style:{flex:1}})]}),e.jsxs(w,{justify:"flex-end",mt:"md",children:[e.jsx(P,{variant:"default",size:"xs",onClick:()=>{j(void 0),t(void 0),o.setFilterValue([void 0,void 0]),x(!1)},children:"Clear"}),e.jsx(P,{size:"xs",onClick:()=>{o.setFilterValue([f,l]),x(!1)},children:"Done"})]})]})})]})}if(g==="date-range"){const s=a||[null,null];return e.jsx(G,{type:"range",size:"xs",placeholder:"Pick dates range",value:s,onChange:x=>o.setFilterValue(x),clearable:!0,popoverProps:{withinPortal:!0},style:{minWidth:220}})}return o.id==="status"?e.jsx(z,{size:"xs",placeholder:"Filter by Status",data:["Pending","Collected","Failed","Processing"].map(s=>({label:s,value:s})),value:a||null,onChange:s=>o.setFilterValue(s),clearable:!0}):o.id==="paymentMethod"?e.jsx(z,{size:"xs",placeholder:"Filter by Method",data:["Card","Cash","Transfer","Online"].map(s=>({label:s,value:s})),value:a||null,onChange:s=>o.setFilterValue(s),clearable:!0}):e.jsx(W,{size:"xs",placeholder:`Search ${o.columnDef.header}...`,value:a??"",onChange:s=>o.setFilterValue(s.target.value),variant:"filled"})}const oe=function(){const a=V({from:"/customer/$customerId"}),g=(a==null?void 0:a.name)||"Customer",[m,p]=h.useState([]),[c,D]=h.useState([]),[s,x]=h.useState({pageIndex:0,pageSize:5}),v=h.useMemo(()=>[C.accessor("collectionId",{header:"Collection ID",cell:t=>t.getValue()}),C.accessor("orderId",{header:"Order ID",cell:t=>t.getValue()}),C.accessor("collectionDate",{header:"Collection Date",cell:t=>{const n=T(t.getValue());return n?n.toLocaleDateString("en-GB"):"Invalid Date"},meta:{filterVariant:"date-range"},filterFn:"inDateRange"}),C.accessor("amountCollected",{header:"Amount",cell:t=>e.jsxs(A,{align:"center",gap:"xs",children:[e.jsx(k,{size:"0.9rem"}),t.getValue().toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),meta:{filterVariant:"number-range",rangeMin:0,rangeMax:500,rangeStep:.01},filterFn:"inNumberRange"}),C.accessor("paymentMethod",{header:"Payment Method",cell:t=>t.getValue()}),C.accessor("status",{header:"Status",cell:t=>{const n=t.getValue();let r="gray";return n==="Collected"?r="green":n==="Processing"?r="blue":n==="Pending"?r="orange":n==="Failed"&&(r="red"),e.jsx(S,{style:{backgroundColor:`var(--mantine-color-${r}-1)`,borderLeft:`3px solid var(--mantine-color-${r}-6)`,padding:"6px 10px",borderRadius:"4px",color:`var(--mantine-color-${r}-9)`,fontWeight:500},children:n})}})],[]),I=(t,n,r)=>{const d=t.getValue(n);if(!d)return!1;const i=T(d);if(!i)return!1;i.setHours(0,0,0,0);const[M,R]=r;return!(M&&i<new Date(new Date(M).setHours(0,0,0,0))||R&&i>new Date(new Date(R).setHours(23,59,59,999)))},f=(t,n,r)=>{const d=t.getValue(n);if(typeof d!="number")return!1;const[i,M]=r;return!(i!==void 0&&d<i||M!==void 0&&d>M)},l=Y({data:ee,columns:v,state:{columnFilters:m,sorting:c,pagination:s},onColumnFiltersChange:p,onSortingChange:D,onPaginationChange:x,getCoreRowModel:J(),getFilteredRowModel:U(),getSortedRowModel:K(),getPaginationRowModel:q(),filterFns:{inDateRange:I,inNumberRange:f},defaultColumn:{minSize:50,size:160,maxSize:500}});return e.jsxs(e.Fragment,{children:[e.jsxs(H,{order:3,mb:"lg",children:["Collections for ",g]}),l.getState().columnFilters.length>0&&e.jsx(w,{justify:"flex-end",children:e.jsx(P,{style:{marginLeft:"auto"},variant:"filled",size:"xs",onClick:()=>l.resetColumnFilters(),mb:"md",leftSection:e.jsx(L,{size:14}),children:"Reset All Filters"})}),e.jsx($,{radius:"md",shadow:"md",p:"xs",withBorder:!0,children:e.jsx(B,{children:e.jsxs(u,{highlightOnHover:!0,withColumnBorders:!0,verticalSpacing:"md",miw:700,children:[e.jsx(u.Thead,{children:l.getHeaderGroups().map(t=>e.jsx(u.Tr,{children:t.headers.map(n=>e.jsx(u.Th,{colSpan:n.colSpan,style:{width:n.getSize()},children:n.isPlaceholder?null:e.jsxs(S,{children:[e.jsxs(w,{justify:"space-between",wrap:"nowrap",gap:"xs",children:[e.jsx(y,{fw:500,lineClamp:1,style:{whiteSpace:"nowrap"},children:O(n.column.columnDef.header,n.getContext())}),n.column.getCanSort()&&e.jsx(N,{variant:"subtle",size:"xs",onClick:n.column.getToggleSortingHandler(),children:{asc:e.jsx(X,{size:14}),desc:e.jsx(Q,{size:14})}[n.column.getIsSorted()]??e.jsx(Z,{size:14})})]}),n.column.getCanFilter()?e.jsx(S,{mt:4,children:e.jsx(te,{column:n.column})}):null]})},n.id))},t.id))}),e.jsxs(u.Tbody,{children:[l.getRowModel().rows.map(t=>e.jsx(u.Tr,{children:t.getVisibleCells().map(n=>e.jsx(u.Td,{style:{width:n.column.getSize()},children:O(n.column.columnDef.cell,n.getContext())},n.id))},t.id)),l.getRowModel().rows.length===0&&e.jsx(u.Tr,{children:e.jsx(u.Td,{colSpan:l.getAllColumns().length,children:e.jsx(y,{ta:"center",p:"md",children:"No collections found."})})})]})]})})}),e.jsxs(w,{justify:"space-between",mt:"md",children:[e.jsxs(y,{size:"sm",children:["Page ",l.getState().pagination.pageIndex+1," of"," ",l.getPageCount()||1]}),e.jsx(_,{total:l.getPageCount()||1,value:l.getState().pagination.pageIndex+1,onChange:t=>l.setPageIndex(t-1),size:"sm"}),e.jsx(z,{size:"xs",data:["5","10","20"].map(t=>({label:`${t} rows`,value:t})),value:l.getState().pagination.pageSize.toString(),onChange:t=>{t&&l.setPageSize(Number(t))}})]})]})};export{oe as component};
