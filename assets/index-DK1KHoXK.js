import{ad as H,n as B,l as q,K as x,j as e,ao as G,ap as W,B as w,C as E,G as b,q as T,P as Y,ak as K,T as z,A as O,al as A,Q,r as I,L as U,R as J,am as N,a2 as $,an as X,o as Z}from"./index-CU1GZXRK.js";import{c as _,u as ee,g as te,e as ae,h as ne,i as re,I as L,T as c,f as k,a as se,b as ie,d as oe,P as le}from"./index-BN8vmPc7.js";function F(s){if(!s)return null;const n=s.split("/");if(n.length===3){const u=parseInt(n[0],10),l=parseInt(n[1],10)-1,g=parseInt(n[2],10);if(!isNaN(u)&&!isNaN(l)&&!isNaN(g)){const d=new Date(g,l,u);if(d.getFullYear()===g&&d.getMonth()===l&&d.getDate()===u)return d}}return null}const de=[{orderId:"ORD001",orderDate:"15/01/2023",deliveryDate:"18/01/2023",productName:"Vanilla Swirls",quantity:2,unitPrice:15.99,status:"Delivered"},{orderId:"ORD002",orderDate:"20/02/2023",deliveryDate:"23/02/2023",productName:"Chocolate Dreams",quantity:1,unitPrice:22.5,status:"Shipped"},{orderId:"ORD003",orderDate:"10/03/2023",deliveryDate:void 0,productName:"Strawberry Clouds",quantity:5,unitPrice:12,status:"Pending"},{orderId:"ORD004",orderDate:"12/03/2023",deliveryDate:"12/03/2023",productName:"Minty Fresh",quantity:3,unitPrice:10.75,status:"Delivered"},{orderId:"ORD005",orderDate:"01/04/2023",deliveryDate:void 0,productName:"Caramel Crunch",quantity:2,unitPrice:18,status:"Cancelled"}],C=_();function ce({column:s}){var l,g,d,P;const n=s.getFilterValue(),u=(l=s.columnDef.meta)==null?void 0:l.filterVariant;if(u==="number-range"){const[o,p]=x.useState(!1),M=n==null?void 0:n[0],R=n==null?void 0:n[1],[f,j]=x.useState(M),[v,D]=x.useState(R),i=(g=s.columnDef.meta)==null?void 0:g.rangeMin,t=(d=s.columnDef.meta)==null?void 0:d.rangeMax,a=((P=s.columnDef.meta)==null?void 0:P.rangeStep)??1;return x.useMemo(()=>{o||(j(n==null?void 0:n[0]),D(n==null?void 0:n[1]))},[n,o]),e.jsxs(N,{opened:o,onClose:()=>p(!1),position:"bottom-start",withArrow:!0,shadow:"md",trapFocus:!0,onOpen:()=>{j(n==null?void 0:n[0]),D(n==null?void 0:n[1])},children:[e.jsx(N.Target,{children:e.jsx(O,{variant:o?"filled":s.getIsFiltered()?"light":"default",onClick:()=>p(r=>!r),size:"input-xs",title:"Set number range",style:{lineHeight:1},children:e.jsx(L,{size:"1rem"})})}),e.jsxs(N.Dropdown,{p:"sm",style:{minWidth:230},children:[" ",e.jsxs(w,{children:[e.jsxs(b,{grow:!0,align:"flex-start",gap:"xs",children:[" ",e.jsx($,{label:"Min",placeholder:i!==void 0?`Min: ${i}`:"Minimum",value:f===void 0?"":f,onChange:r=>j(r===""?void 0:Number(r)),min:i,max:v??t,step:a,size:"xs",variant:"filled",style:{flex:1}}),e.jsx($,{label:"Max",placeholder:t!==void 0?`Max: ${t}`:"Maximum",value:v===void 0?"":v,onChange:r=>D(r===""?void 0:Number(r)),min:f??i,max:t,step:a,size:"xs",variant:"filled",style:{flex:1}})]}),e.jsxs(b,{justify:"flex-end",mt:"md",children:[e.jsx(T,{variant:"default",size:"xs",onClick:()=>{j(void 0),D(void 0),s.setFilterValue([void 0,void 0]),p(!1)},children:"Clear"}),e.jsx(T,{size:"xs",onClick:()=>{let r=f,m=v;s.setFilterValue([r,m]),p(!1)},children:"Done"})]})]})]})]})}if(u==="date-range"){const o=n||[null,null];return e.jsx(X,{type:"range",size:"xs",placeholder:"Pick dates range",value:o,onChange:p=>s.setFilterValue(p),clearable:!0,popoverProps:{withinPortal:!0},style:{minWidth:220}})}return s.id==="status"?e.jsx(A,{size:"xs",placeholder:`Filter by ${s.columnDef.header}`,data:["Pending","Shipped","Delivered","Cancelled"].map(o=>({label:o,value:o})),value:n||null,onChange:o=>s.setFilterValue(o),clearable:!0}):e.jsx(Z,{size:"xs",placeholder:`Search ${s.columnDef.header}...`,value:n??"",onChange:o=>s.setFilterValue(o.target.value),variant:"filled"})}const pe=function(){const n=H({from:"/customer/$customerId"}),u=(n==null?void 0:n.name)||"Customer",l=n==null?void 0:n.id,g=B(),d=q(),[P,o]=x.useState([]),[p,M]=x.useState([]),[R,f]=x.useState({pageIndex:0,pageSize:5}),j=x.useMemo(()=>[C.accessor("orderId",{header:"Order ID",cell:t=>t.getValue()}),C.accessor("orderDate",{header:"Order Date",cell:t=>{const a=F(t.getValue());return a?a.toLocaleDateString("en-GB"):"Invalid Date"},meta:{filterVariant:"date-range"},filterFn:"inDateRange"}),C.accessor("deliveryDate",{header:"Delivery Date",cell:t=>{const a=t.getValue();if(!a)return"N/A";const r=F(a);return r?r.toLocaleDateString("en-GB"):"Invalid Date"},meta:{filterVariant:"date-range"},filterFn:"inDateRange"}),C.accessor(t=>t.quantity*t.unitPrice,{id:"invoicePrice",header:"Invoice Price",cell:t=>e.jsxs(G,{align:"center",gap:"xs",children:[e.jsx(W,{size:"0.9rem"}),t.getValue().toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),meta:{filterVariant:"number-range",rangeMin:0,rangeMax:1e3,rangeStep:.01},filterFn:"inNumberRange"}),C.accessor("status",{header:"Status",cell:t=>{const a=t.getValue();let r="gray";return a==="Delivered"?r="green":a==="Shipped"?r="blue":a==="Pending"?r="orange":a==="Cancelled"&&(r="red"),e.jsx(w,{style:{backgroundColor:`var(--mantine-color-${r}-1)`,borderLeft:`3px solid var(--mantine-color-${r}-6)`,padding:"6px 10px",borderRadius:"4px",color:`var(--mantine-color-${r}-9)`,fontWeight:500},children:a})}})],[]),v=(t,a,r)=>{const m=t.getValue(a);if(!m)return!1;const h=F(m);if(!h)return!1;h.setHours(0,0,0,0);const[S,V]=r;if(S){const y=new Date(S);if(y.setHours(0,0,0,0),h<y)return!1}if(V){const y=new Date(V);if(y.setHours(23,59,59,999),h>y)return!1}return!0},D=(t,a,r)=>{const m=t.getValue(a);if(typeof m!="number")return!1;const[h,S]=r;return!(h!==void 0&&m<h||S!==void 0&&m>S)},i=ee({data:de,columns:j,state:{columnFilters:P,sorting:p,pagination:R},onColumnFiltersChange:o,onSortingChange:M,onPaginationChange:f,getCoreRowModel:re(),getFilteredRowModel:ne(),getSortedRowModel:ae(),getPaginationRowModel:te(),filterFns:{inDateRange:v,inNumberRange:D},defaultColumn:{minSize:40,size:180,maxSize:800}});return e.jsxs(e.Fragment,{children:[e.jsxs(E,{order:3,mb:"lg",children:["Orders for ",u]}),i.getState().columnFilters.length>0&&e.jsx(b,{justify:"flex-end",children:e.jsx(T,{style:{marginLeft:"auto"},variant:"filled",size:"xs",onClick:()=>i.resetColumnFilters(),mb:"md",leftSection:e.jsx(L,{size:14}),children:"Reset All Filters"})}),e.jsx(Y,{radius:"md",shadow:"md",p:"xs",withBorder:!0,children:e.jsx(K,{style:{padding:0},children:e.jsxs(c,{highlightOnHover:!0,withColumnBorders:!0,verticalSpacing:"md",children:[e.jsx(c.Thead,{children:i.getHeaderGroups().map(t=>e.jsx(c.Tr,{children:t.headers.map(a=>e.jsx(c.Th,{colSpan:a.colSpan,style:{width:a.getSize()},children:a.isPlaceholder?null:e.jsxs(w,{children:[e.jsxs(b,{justify:"space-between",wrap:"nowrap",gap:"xs",children:[e.jsx(z,{fw:500,lineClamp:1,style:{whiteSpace:"nowrap"},children:k(a.column.columnDef.header,a.getContext())}),a.column.getCanSort()&&e.jsx(O,{variant:"subtle",size:"xs",onClick:a.column.getToggleSortingHandler(),children:{asc:e.jsx(ie,{size:14}),desc:e.jsx(se,{size:14})}[a.column.getIsSorted()]??e.jsx(oe,{size:14})})]}),a.column.getCanFilter()?e.jsx(w,{mt:4,children:e.jsx(ce,{column:a.column})}):null]})},a.id))},t.id))}),e.jsxs(c.Tbody,{children:[i.getRowModel().rows.map(t=>e.jsx(c.Tr,{onClick:()=>{l&&g({to:"/customer/$customerId/orders/$orderId/details",params:{customerId:l,orderId:t.original.orderId}})},style:{cursor:"pointer"},children:t.getVisibleCells().map(a=>e.jsx(c.Td,{style:{width:a.column.getSize(),paddingTop:"16px",paddingBottom:"16px"},children:k(a.column.columnDef.cell,a.getContext())},a.id))},t.id)),i.getRowModel().rows.length===0&&e.jsx(c.Tr,{children:e.jsx(c.Td,{colSpan:i.getAllColumns().length,children:e.jsx(z,{ta:"center",p:"md",children:"No orders found."})})})]})]})})}),e.jsxs(b,{justify:"space-between",mt:"md",children:[e.jsxs(z,{size:"sm",children:["Page ",i.getState().pagination.pageIndex+1," of"," ",i.getPageCount()]}),e.jsx(le,{total:i.getPageCount(),value:i.getState().pagination.pageIndex+1,onChange:t=>i.setPageIndex(t-1),size:"sm"}),e.jsx(A,{size:"xs",data:["5","10","20"].map(t=>({label:`${t} rows`,value:t})),value:i.getState().pagination.pageSize.toString(),onChange:t=>i.setPageSize(Number(t))})]}),l&&e.jsx(Q,{position:{bottom:40,right:35},children:e.jsx(w,{style:{borderRadius:"9999px",boxShadow:d.shadows.md},children:e.jsx(O,{component:U,to:`/customer/${l}/orders/add`,variant:"filled",style:{width:I(56),height:I(56)},radius:"xl","aria-label":"Add new order",color:d.primaryColor,children:e.jsx(J,{style:{width:I(28),height:I(28)}})})})})]})};export{pe as component};
