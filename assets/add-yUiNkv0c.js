import{j as e,n as U,X as Q,m as H,l as X,F as P,ah as _,ai as J,D as K,y as C,P as w,G as b,A as k,aj as W,o as V,a1 as M,$ as Z,ak as ee,Y as z,B as j,r as f,U as se,x as E,a4 as x,T as t,al as S,am as re,a6 as te,q as B,an as ie,ao as ae,ap as ne,aq as d}from"./index-BdFAjZwO.js";function v({label:c,value:a,isTextarea:I}){return e.jsxs(j,{mb:"md",children:[e.jsx(t,{size:"sm",fw:500,c:"dimmed",children:c}),I?e.jsx(w,{p:"xs",withBorder:!0,shadow:"0",children:e.jsx(t,{size:"sm",style:{whiteSpace:"pre-wrap"},children:a||"-"})}):e.jsx(t,{size:"sm",children:a||"-"})]})}const le=d.object({productId:d.string(),name:d.string(),image:d.string(),unitPrice:d.number(),quantity:d.number().min(1,{message:"Quantity must be at least 1"})}),de=d.object({orderId:d.string().min(1,{message:"Order ID is required"}),orderDate:d.date({required_error:"Order date is required"}),deliveryDate:d.date().nullable().optional(),paymentType:d.string().min(1,{message:"Payment type is required"}),comments:d.string().optional(),orderItems:d.array(le).min(1,{message:"At least one product must be added to the order"})}).refine(c=>!(c.deliveryDate&&c.orderDate&&c.deliveryDate<c.orderDate),{message:"Delivery date cannot be before order date",path:["deliveryDate"]});function oe({addMode:c=!0,orderData:a}){const I=U(),h=Q({from:"/customer/$customerId"}),O=(h==null?void 0:h.name)||"Customer",D=h==null?void 0:h.id,{colorScheme:p}=H(),y=X(),[m,q]=P.useState(""),[u,T]=P.useState(!1),o=c,l=!o&&!u,s=_({initialValues:!o&&a?a:{orderId:"",orderDate:null,deliveryDate:null,paymentType:"",comments:"",orderItems:[]},validate:ne(de)});P.useEffect(()=>{!o&&a&&(s.setValues(a),s.resetDirty(a))},[o,a,s.setValues,s.resetDirty]);const L=o?`Add New Order for ${O}`:u?`Edit Order ${(a==null?void 0:a.orderId)||""} for ${O}`:`Order Details: ${(a==null?void 0:a.orderId)||""} for ${O}`,F=P.useMemo(()=>m.trim()?J.filter(r=>r.name.toLowerCase().includes(m.toLowerCase())||r.description.toLowerCase().includes(m.toLowerCase())).slice(0,5):[],[m]),Y=r=>{const i=s.values.orderItems,n=i.findIndex(g=>g.productId===r.id);n===-1?s.insertListItem("orderItems",{productId:r.id,name:r.name,image:r.image,unitPrice:r.price,quantity:1}):s.setFieldValue(`orderItems.${n}.quantity`,i[n].quantity+1),q("")},N=r=>{console.log("Form submitted with values:",r),D&&I({to:`/customer/${D}/orders/`})};return e.jsxs(K,{p:0,pb:"xl",children:[e.jsx(C,{order:2,mb:"md",ta:"center",children:L}),e.jsxs(w,{withBorder:!0,shadow:"md",p:"sm",radius:"md",children:[!o&&!u&&e.jsx(b,{justify:"flex-end",mb:"xs",children:e.jsx(k,{variant:"outline",color:"blue",onClick:()=>T(!0),title:"Edit Order",children:e.jsx(W,{size:18})})}),e.jsxs("form",{onSubmit:s.onSubmit(N),children:[l?e.jsx(v,{label:"Order ID",value:s.values.orderId}):e.jsx(V,{label:"Order ID",placeholder:"Enter order ID (e.g., ORD123)",required:!0,mb:"md",...s.getInputProps("orderId"),readOnly:l}),l?e.jsx(v,{label:"Order Date",value:s.values.orderDate?new Date(s.values.orderDate).toLocaleDateString():"N/A"}):e.jsx(M,{label:"Order Date",placeholder:"Select order date",required:!0,mb:"md",valueFormat:"DD/MM/YYYY",popoverProps:{withinPortal:!0},...s.getInputProps("orderDate"),readOnly:l}),l?e.jsx(v,{label:"Delivery Date",value:s.values.deliveryDate?new Date(s.values.deliveryDate).toLocaleDateString():"N/A"}):e.jsx(M,{label:"Delivery Date (Optional)",placeholder:"Select delivery date",mb:"md",valueFormat:"DD/MM/YYYY",popoverProps:{withinPortal:!0},minDate:s.values.orderDate||void 0,clearable:!0,...s.getInputProps("deliveryDate"),readOnly:l}),l?e.jsx(v,{label:"Payment Type",value:s.values.paymentType||"N/A"}):e.jsx(Z,{label:"Payment Type",placeholder:"Select payment type",required:!0,mb:"md",data:[{value:"Card",label:"Card"},{value:"Cash",label:"Cash"},{value:"Online",label:"Online"},{value:"Pending",label:"Pending Confirmation"}],...s.getInputProps("paymentType"),readOnly:l}),l?e.jsx(v,{label:"Comments",value:s.values.comments||"N/A",isTextarea:!0}):e.jsx(ee,{label:"Comments (Optional)",placeholder:"Enter any comments for the order",mb:"xl",minRows:3,autosize:!0,...s.getInputProps("comments"),readOnly:l}),e.jsx(z,{my:"lg",label:"Order Items",labelPosition:"center"}),(o||u)&&e.jsxs(j,{style:{position:"relative",marginBottom:y.spacing.md},children:[e.jsx(V,{label:"Search Products to Add",placeholder:"Type product name or description...",value:m,onChange:r=>q(r.currentTarget.value)}),m&&e.jsx(j,{style:{position:"absolute",top:`calc(100% + ${y.spacing.xs})`,left:0,right:0,zIndex:1e3,maxHeight:f(320),overflowY:"auto",borderRadius:y.radius.sm},children:F.length>0?e.jsx(w,{shadow:"sm",p:"xs",withBorder:!0,children:F.map(r=>e.jsx(se,{onClick:()=>Y(r),style:{display:"block",width:"100%"},mb:"xs",children:e.jsx(j,{p:"xs",style:i=>({border:`1px solid ${p==="dark"?i.colors.dark[4]:i.colors.gray[3]}`,borderRadius:i.radius.sm,backgroundColor:p==="dark"?i.colors.dark[6]:i.white,transition:"background-color 100ms ease","&:hover":{backgroundColor:p==="dark"?i.colors.dark[5]:i.colors.gray[0]}}),children:e.jsxs(b,{wrap:"nowrap",gap:"md",align:"stretch",children:[e.jsx(j,{style:{flexShrink:0,width:f(50),height:f(50)},children:e.jsx(E,{src:r.image,alt:r.name,width:50,height:50,fit:"cover",radius:"sm"})}),e.jsxs(x,{direction:"column",justify:"space-between",style:{flexGrow:1,overflow:"hidden"},children:[e.jsx(C,{order:6,fw:500,lineClamp:2,children:r.name}),e.jsxs(t,{size:"xs",c:"dimmed",mt:"auto",children:["£",r.price.toFixed(2)]})]})]})})},r.id))}):e.jsx(w,{shadow:"sm",p:"md",withBorder:!0,children:e.jsxs(t,{size:"sm",c:"dimmed",ta:"center",children:['No products found matching "',m,'".']})})})]}),s.values.orderItems.length===0&&!m&&(o||u)&&e.jsx(t,{c:"dimmed",ta:"center",my:"md",children:"Search and select products to add them to the order."}),s.values.orderItems.length>0&&e.jsx(S,{variant:"default",defaultValue:"order-items-panel",mt:"md",mb:"md",p:0,styles:{content:{padding:0}},children:e.jsxs(S.Item,{value:"order-items-panel",children:[e.jsx(S.Control,{children:e.jsxs(t,{fw:500,children:["View/Edit Added Products (",s.values.orderItems.length," ","item",s.values.orderItems.length!==1?"s":"",")"]})}),e.jsx(S.Panel,{p:0,children:s.values.orderItems.map((r,i)=>e.jsxs(b,{wrap:"nowrap",align:"center",mb:"xs",p:"xs",style:n=>({border:`1px solid ${p==="dark"?n.colors.dark[4]:n.colors.gray[3]}`,borderRadius:n.radius.sm,backgroundColor:p==="dark"?n.colors.dark[6]:n.white}),children:[e.jsx(j,{style:{flexShrink:0,width:60,height:60},children:e.jsx(E,{src:r.image,alt:r.name,fit:"contain",radius:"sm"})}),e.jsxs(x,{direction:"column",justify:"space-between",style:{flexGrow:1,overflow:"hidden"},children:[e.jsx(t,{truncate:"end",fw:500,size:"sm",lineClamp:1,children:r.name}),e.jsxs(t,{size:"xs",c:"dimmed",mt:"auto",children:["£",r.unitPrice.toFixed(2)," each"]})]}),e.jsxs(x,{direction:"column",align:"flex-end",justify:"center",style:{flexShrink:0},children:[e.jsxs(b,{gap:3,wrap:"nowrap",align:"center",children:[e.jsx(k,{size:"sm",variant:"light",color:"red",onClick:()=>{const n=s.values.orderItems[i].quantity;n>1?s.setFieldValue(`orderItems.${i}.quantity`,n-1):s.removeListItem("orderItems",i)},"aria-label":"Decrease quantity",disabled:l,children:e.jsx(re,{size:14})}),e.jsx(t,{w:f(24),ta:"center",size:"sm",fw:500,children:r.quantity}),e.jsx(k,{size:"sm",variant:"light",color:"green",onClick:()=>s.setFieldValue(`orderItems.${i}.quantity`,s.values.orderItems[i].quantity+1),"aria-label":"Increase quantity",disabled:l,children:e.jsx(te,{size:14})})]}),e.jsxs(t,{size:"xs",c:"dimmed",mt:f(4),children:["Total: £",(r.unitPrice*r.quantity).toFixed(2)]})]})]},r.productId))})]})}),s.values.orderItems.length>0&&e.jsxs(w,{withBorder:!0,radius:"md",p:"md",mt:"lg",children:[e.jsx(C,{order:4,mb:"sm",children:"Order Summary"}),(()=>{const r=s.values.orderItems.reduce((G,$)=>G+$.unitPrice*$.quantity,0),i=5,n=20,g=Math.max(0,r-i),A=g*(n/100),R=g+A;return e.jsxs(e.Fragment,{children:[e.jsxs(x,{justify:"space-between",align:"center",mb:"xs",children:[e.jsx(t,{children:"Subtotal:"}),e.jsxs(t,{fw:500,children:["£",r.toFixed(2)]})]}),e.jsxs(x,{justify:"space-between",align:"center",mb:"xs",children:[e.jsx(t,{children:"Discount:"}),e.jsxs(t,{fw:500,children:["- £",i.toFixed(2)]})]}),r<i&&e.jsx(t,{c:"dimmed",size:"xs",mb:"xs",ta:"right",children:"(Discount adjusted to subtotal)"}),e.jsxs(x,{justify:"space-between",align:"center",mb:"xs",children:[e.jsx(t,{children:"Price After Discount:"}),e.jsxs(t,{fw:500,children:["£",g.toFixed(2)]})]}),e.jsxs(x,{justify:"space-between",align:"center",mb:"xs",children:[e.jsxs(t,{children:["VAT (",n,"%):"]}),e.jsxs(t,{fw:500,children:["£",A.toFixed(2)]})]}),e.jsx(z,{my:"sm"}),e.jsxs(x,{justify:"space-between",align:"center",mt:"sm",children:[e.jsx(t,{fw:700,size:"lg",children:"Grand Total:"}),e.jsxs(t,{fw:700,size:"lg",c:p==="dark"?y.colors.green[4]:y.colors.green[7],children:["£",R.toFixed(2)]})]})]})})()]}),s.values.orderItems.length>0&&e.jsx(z,{my:"lg"}),e.jsxs(b,{justify:"flex-end",mt:"xl",children:[e.jsx(B,{variant:"default",onClick:()=>{!o&&u?(T(!1),a&&s.resetDirty(a)):I({to:D?`/customer/${D}/orders/`:"/customers"})},leftSection:e.jsx(ie,{size:14}),children:!o&&u?"Cancel Edit":"Cancel"}),(o||u)&&e.jsx(B,{type:"submit",leftSection:e.jsx(ae,{size:14}),disabled:l||!s.isValid()&&s.isDirty(),children:o?"Save Order":"Update Order"})]})]})]})]})}const me=()=>e.jsx(oe,{addMode:!0});export{oe as CustomerAddOrderPage,me as component};
